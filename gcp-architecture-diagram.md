# Google Cloud Hybrid Network Architecture
## On-Premises Simulation with Gemini API Access

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    Google Cloud Platform                                         â”‚
â”‚                                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Dev Project (On-Prem Simulation)  â”‚         â”‚    Prod Project (Gemini API)       â”‚       â”‚
â”‚  â”‚   ID: on-prem-sim-[random]          â”‚         â”‚    ID: gemini-api-prod-[random]    â”‚       â”‚
â”‚  â”‚                                     â”‚         â”‚                                     â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚  â”‚  â”‚    Dev VPC (10.0.0.0/16)    â”‚   â”‚         â”‚   â”‚   Prod VPC (10.1.0.0/16)   â”‚  â”‚       â”‚
â”‚  â”‚  â”‚                             â”‚   â”‚         â”‚   â”‚                             â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚         â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ Dev Subnet            â”‚  â”‚   â”‚         â”‚   â”‚  â”‚ Prod Subnet           â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ (10.0.1.0/24)         â”‚  â”‚   â”‚         â”‚   â”‚  â”‚ (10.1.1.0/24)         â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚                       â”‚  â”‚   â”‚         â”‚   â”‚  â”‚                       â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚         â”‚   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ â”‚ Dev Workstation â”‚  â”‚  â”‚   â”‚         â”‚   â”‚  â”‚ â”‚ Prod Test VM    â”‚  â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ â”‚ e2-medium       â”‚  â”‚  â”‚   â”‚         â”‚   â”‚  â”‚ â”‚ e2-micro        â”‚  â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ â”‚ Debian 11       â”‚  â”‚  â”‚   â”‚         â”‚   â”‚  â”‚ â”‚ Debian 11       â”‚  â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ â”‚ No External IP  â”‚  â”‚  â”‚   â”‚         â”‚   â”‚  â”‚ â”‚ Internal Only   â”‚  â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚         â”‚   â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚                       â”‚  â”‚   â”‚         â”‚   â”‚  â”‚                       â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚         â”‚   â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ â”‚   Cloud NAT     â”‚  â”‚  â”‚   â”‚         â”‚   â”‚  â”‚ â”‚   Cloud NAT     â”‚  â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ â”‚   dev-nat       â”‚  â”‚  â”‚   â”‚         â”‚   â”‚  â”‚ â”‚   prod-nat      â”‚  â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚         â”‚   â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚         â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚       â”‚
â”‚  â”‚  â”‚                             â”‚   â”‚         â”‚   â”‚                             â”‚  â”‚       â”‚
â”‚  â”‚  â”‚      [HA VPN Gateway]       â”‚   â”‚         â”‚   â”‚      [HA VPN Gateway]      â”‚  â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                   â”‚                                                 â”‚                         â”‚
â”‚                   â”‚        HA VPN Tunnels (x2)                     â”‚                         â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                            BGP Sessions (ASN: 64512 â†” 64513)                                 â”‚
â”‚                                  IPsec Encrypted                                             â”‚
â”‚                                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                            â”‚
                                            â”‚ API Access
                                            â–¼
                        
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Google APIs & Services                          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Gemini API         â”‚    â”‚   Private Google Access     â”‚   â”‚
â”‚  â”‚   (Vertex AI)           â”‚    â”‚                             â”‚   â”‚
â”‚  â”‚   us-central1           â”‚    â”‚   Cloud DNS                 â”‚   â”‚
â”‚  â”‚   gemini-pro            â”‚    â”‚   restricted.googleapis.com â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   199.36.153.8-11           â”‚   â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Cloud IAP          â”‚
â”‚   SSH Access            â”‚
â”‚   35.235.240.0/20       â”‚
â”‚   No External IP needed â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Dev Workstation
```

## ì£¼ìš” êµ¬ì„± ìš”ì†Œ

### 1. **í”„ë¡œì íŠ¸ êµ¬ì¡°**
- **Dev Project (On-Premises Simulation)**
  - Project ID: `on-prem-sim-[random]`
  - ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì„ ì‹œë®¬ë ˆì´ì…˜
  - ê°œë°œì ì›Œí¬ìŠ¤í…Œì´ì…˜ í˜¸ìŠ¤íŒ…

- **Prod Project (Gemini API)**
  - Project ID: `gemini-api-prod-[random]`
  - Gemini API ì ‘ê·¼ì„ ìœ„í•œ í”„ë¡œë•ì…˜ í™˜ê²½
  - ë³´ì•ˆ ê°•í™”ëœ í™˜ê²½

### 2. **ë„¤íŠ¸ì›Œí¬ êµ¬ì„±**
- **Dev VPC**: `10.0.0.0/16`
  - Dev Subnet: `10.0.1.0/24`
  - Private Google Access í™œì„±í™”
  - Cloud NAT êµ¬ì„± (ì¸í„°ë„· ì•„ì›ƒë°”ìš´ë“œ)

- **Prod VPC**: `10.1.0.0/16`
  - Prod Subnet: `10.1.1.0/24`
  - Private Google Access í™œì„±í™”
  - Cloud NAT êµ¬ì„±

### 3. **VPN ì—°ê²°**
- **HA VPN Gateways**: ì–‘ìª½ VPCì— ê³ ê°€ìš©ì„± VPN ê²Œì´íŠ¸ì›¨ì´
- **VPN Tunnels**: ì´ì¤‘í™”ë¥¼ ìœ„í•œ 2ê°œì˜ í„°ë„
- **BGP Sessions**: 
  - Dev ASN: 64512
  - Prod ASN: 64513
  - ë™ì  ë¼ìš°íŒ…ì„ ìœ„í•œ BGP êµ¬ì„±
- **IPsec ì•”í˜¸í™”**: ëª¨ë“  íŠ¸ë˜í”½ ì•”í˜¸í™”

### 4. **ì»´í“¨íŠ¸ ë¦¬ì†ŒìŠ¤**
- **Dev Workstation**
  - Machine Type: `e2-medium`
  - OS: Debian 11
  - External IP ì—†ìŒ (Cloud IAP í†µí•œ SSH)
  - Service Account: `dev-vm-sa`

- **Prod Test VM**
  - Machine Type: `e2-micro`
  - OS: Debian 11
  - ë‚´ë¶€ ì „ìš© (External IP ì—†ìŒ)

### 5. **ë³´ì•ˆ êµ¬ì„±**

#### Firewall Rules
- **Dev VPC**:
  - âœ… Cloud IAP SSH í—ˆìš© (35.235.240.0/20)
  - âœ… ë‚´ë¶€ í†µì‹  í—ˆìš©
  - âœ… VPN íŠ¸ë˜í”½ í—ˆìš©
  - âœ… Health Check í—ˆìš©

- **Prod VPC**:
  - âœ… VPN íŠ¸ë˜í”½ í—ˆìš©
  - âœ… ë‚´ë¶€ í†µì‹  í—ˆìš©
  - âŒ SSH ì°¨ë‹¨ (ë³´ì•ˆ ê°•í™”)
  - âœ… HTTPS (443) Dev ë„¤íŠ¸ì›Œí¬ì—ì„œë§Œ í—ˆìš©

#### IAM êµ¬ì„±
- **Service Account**: `dev-vm-sa`
  - Dev Project: `roles/aiplatform.user`
  - Prod Project: `roles/aiplatform.user` (Cross-project access)
  - Logging/Monitoring ê¶Œí•œ

- **User Access**:
  - `roles/iap.tunnelResourceAccessor` (IAP SSH)
  - `roles/compute.instanceAdmin.v1`
  - `roles/iam.serviceAccountUser`

### 6. **Google API ì ‘ê·¼**
- **Private Google Access**: í™œì„±í™”
- **Cloud DNS**: 
  - Private zone for `googleapis.com`
  - `restricted.googleapis.com` â†’ `199.36.153.8-11`
- **Gemini API**:
  - Vertex AI í†µí•œ ì ‘ê·¼
  - Region: `us-central1`
  - Model: `gemini-pro`

### 7. **ê´€ë¦¬ ë„êµ¬**
- **Cloud IAP**: External IP ì—†ì´ ì•ˆì „í•œ SSH ì ‘ê·¼
- **Cloud NAT**: ì•„ì›ƒë°”ìš´ë“œ ì¸í„°ë„· ì—°ê²°
- **Cloud Logging**: ëª¨ë“  í™œë™ ë¡œê¹…
- **Audit Logging**: Gemini API ì‚¬ìš© ê°ì‚¬

## ë°ì´í„° íë¦„

1. **SSH ì ‘ê·¼**: User â†’ Cloud IAP â†’ Dev Workstation
2. **Gemini API í˜¸ì¶œ**: 
   - Dev Workstation â†’ Dev VPC â†’ VPN â†’ Prod VPC â†’ Private Google Access â†’ Gemini API
3. **ì¸í„°ë„· ì ‘ê·¼**: VM â†’ Cloud NAT â†’ Internet

## ì£¼ìš” íŠ¹ì§•

- ğŸ”’ **ë³´ì•ˆ**: External IP ì—†ì´ Cloud IAP í†µí•œ ì•ˆì „í•œ ì ‘ê·¼
- ğŸ”„ **ê³ ê°€ìš©ì„±**: HA VPN with dual tunnels
- ğŸŒ **Private Access**: Google APIì— ëŒ€í•œ í”„ë¼ì´ë¹— ì ‘ê·¼
- ğŸ“Š **ëª¨ë‹ˆí„°ë§**: í¬ê´„ì ì¸ ë¡œê¹… ë° ê°ì‚¬
- ğŸ” **ê²©ë¦¬**: í”„ë¡œì íŠ¸ ê°„ ê²©ë¦¬ ë° ìµœì†Œ ê¶Œí•œ ì›ì¹™